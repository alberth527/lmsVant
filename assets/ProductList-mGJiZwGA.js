import{t as q,m as H,b as D,c as A,d as K,a as Y,e as z,f as j,i as te,L as G,w as U,n as ne,g as se,h as ae,p as X,j as J,k as O,N as oe,B as ie}from"./index-qFpobu3P.js";import{u as ce}from"./index-1Fa4O1GC.js";import{u as le,T as re,a as ue}from"./index-B11nnFSB.js";import{F as de,f as Q}from"./index-DLbtLx72.js";import{d as M,r as x,g as W,j as F,k as fe,l as he,c,n as Z,m as ge,p as me,_ as ve,u as _e,a as $,b as m,w as E,t as y,h as B,e as be,o as L,F as ke,i as Te,q as pe,s as xe,f as Se}from"./index-B6FFb5jA.js";import{u as Ce,s as we}from"./products-BShfodoU.js";import{s as N}from"./function-call-BE3AcPyQ.js";const[ye,I,Ie]=A("list"),Pe={error:Boolean,offset:D(300),loading:Boolean,disabled:Boolean,finished:Boolean,scroller:Object,errorText:String,direction:H("down"),loadingText:String,finishedText:String,immediateCheck:q};var Ve=M({name:ye,props:Pe,emits:["load","update:error","update:loading"],setup(e,{emit:r,slots:a}){const u=x(e.loading),d=x(),f=x(),v=le(),l=K(d),h=W(()=>e.scroller||l.value),_=()=>{Z(()=>{if(u.value||e.finished||e.disabled||e.error||v?.value===!1)return;const{direction:s}=e,T=+e.offset,g=j(h);if(!g.height||te(d))return;let k=!1;const S=j(f);s==="up"?k=g.top-S.top<=T:k=S.bottom-g.bottom<=T,k&&(u.value=!0,r("update:loading",!0),r("load"))})},p=()=>{if(e.finished){const s=a.finished?a.finished():e.finishedText;if(s)return c("div",{class:I("finished-text")},[s])}},C=()=>{r("update:error",!1),_()},b=()=>{if(e.error){const s=a.error?a.error():e.errorText;if(s)return c("div",{role:"button",class:I("error-text"),tabindex:0,onClick:C},[s])}},i=()=>{if(u.value&&!e.finished&&!e.disabled)return c("div",{class:I("loading")},[a.loading?a.loading():c(G,{class:I("loading-icon")},{default:()=>[e.loadingText||Ie("loading")]})])};return F(()=>[e.loading,e.finished,e.error],_),v&&F(v,s=>{s&&_()}),fe(()=>{u.value=e.loading}),he(()=>{e.immediateCheck&&_()}),Y({check:_}),z("scroll",_,{target:h,passive:!0}),()=>{var s;const T=(s=a.default)==null?void 0:s.call(a),g=c("div",{ref:f,class:I("placeholder")},null);return c("div",{ref:d,role:"feed",class:I(),"aria-busy":u.value},[e.direction==="down"?T:g,i(),p(),b(),e.direction==="up"?T:g])}}});const $e=U(Ve),[Ee,P,Le]=A("pull-refresh"),ee=50,De=["pulling","loosing","success"],Re={disabled:Boolean,modelValue:Boolean,headHeight:D(ee),successText:String,pullingText:String,loosingText:String,loadingText:String,pullDistance:ne,successDuration:D(500),animationDuration:D(300)};var Be=M({name:Ee,props:Re,emits:["change","refresh","update:modelValue"],setup(e,{emit:r,slots:a}){let u;const d=x(),f=x(),v=K(d),l=ge({status:"normal",distance:0,duration:0}),h=se(),_=()=>{if(e.headHeight!==ee)return{height:`${e.headHeight}px`}},p=()=>l.status!=="loading"&&l.status!=="success"&&!e.disabled,C=n=>{const t=+(e.pullDistance||e.headHeight);return n>t&&(n<t*2?n=t+(n-t)/2:n=t*1.5+(n-t*2)/4),Math.round(n)},b=(n,t)=>{const o=+(e.pullDistance||e.headHeight);l.distance=n,t?l.status="loading":n===0?l.status="normal":n<o?l.status="pulling":l.status="loosing",r("change",{status:l.status,distance:n})},i=()=>{const{status:n}=l;return n==="normal"?"":e[`${n}Text`]||Le(n)},s=()=>{const{status:n,distance:t}=l;if(a[n])return a[n]({distance:t});const o=[];return De.includes(n)&&o.push(c("div",{class:P("text")},[i()])),n==="loading"&&o.push(c(G,{class:P("loading")},{default:i})),o},T=()=>{l.status="success",setTimeout(()=>{b(0)},+e.successDuration)},g=n=>{u=ae(v.value)===0,u&&(l.duration=0,h.start(n))},k=n=>{p()&&g(n)},S=n=>{if(p()){u||g(n);const{deltaY:t}=h;h.move(n),u&&t.value>=0&&h.isVertical()&&(X(n),b(C(t.value)))}},w=()=>{u&&h.deltaY.value&&p()&&(l.duration=+e.animationDuration,l.status==="loosing"?(b(+e.headHeight,!0),r("update:modelValue",!0),Z(()=>r("refresh"))):b(0))};return F(()=>e.modelValue,n=>{l.duration=+e.animationDuration,n?b(+e.headHeight,!0):a.success||e.successText?T():b(0,!1)}),z("touchmove",S,{target:f}),()=>{var n;const t={transitionDuration:`${l.duration}ms`,transform:l.distance?`translate3d(0,${l.distance}px, 0)`:""};return c("div",{ref:d,class:P()},[c("div",{ref:f,class:P("track"),style:t,onTouchstartPassive:k,onTouchend:w,onTouchcancel:w},[c("div",{class:P("head"),style:_()},[s()]),(n=a.default)==null?void 0:n.call(a)])])}}});const Ne=U(Be),[He,V,Fe]=A("search"),Ae=J({},Q,{label:String,shape:H("square"),leftIcon:H("search"),clearable:q,actionText:String,background:String,showAction:Boolean});var Ue=M({name:He,props:Ae,emits:["blur","focus","clear","search","cancel","clickInput","clickLeftIcon","clickRightIcon","update:modelValue"],setup(e,{emit:r,slots:a,attrs:u}){const d=ce(),f=x(),v=()=>{a.action||(r("update:modelValue",""),r("cancel"))},l=t=>{t.keyCode===13&&(X(t),r("search",e.modelValue))},h=()=>e.id||`${d}-input`,_=()=>{if(a.label||e.label)return c("label",{class:V("label"),for:h(),"data-allow-mismatch":"attribute"},[a.label?a.label():e.label])},p=()=>{if(e.showAction){const t=e.actionText||Fe("cancel");return c("div",{class:V("action"),role:"button",tabindex:0,onClick:v},[a.action?a.action():t])}},C=()=>{var t;return(t=f.value)==null?void 0:t.blur()},b=()=>{var t;return(t=f.value)==null?void 0:t.focus()},i=t=>r("blur",t),s=t=>r("focus",t),T=t=>r("clear",t),g=t=>r("clickInput",t),k=t=>r("clickLeftIcon",t),S=t=>r("clickRightIcon",t),w=Object.keys(Q),n=()=>{const t=J({},u,O(e,w),{id:h()}),o=R=>r("update:modelValue",R);return c(de,me({ref:f,type:"search",class:V("field",{"with-message":t.errorMessage}),border:!1,onBlur:i,onFocus:s,onClear:T,onKeypress:l,onClickInput:g,onClickLeftIcon:k,onClickRightIcon:S,"onUpdate:modelValue":o},t),O(a,["left-icon","right-icon"]))};return Y({focus:b,blur:C}),()=>{var t;return c("div",{class:V({"show-action":e.showAction}),style:{background:e.background}},[(t=a.left)==null?void 0:t.call(a),c("div",{class:V("content",e.shape)},[_(),n()]),p()])}}});const Me=U(Ue),je={class:"product-list"},Oe={class:"search-section"},qe={class:"filter-section"},Ke={class:"products-container"},Ye={class:"product-grid"},ze=["onClick"],Ge={class:"product-image"},Xe=["src","alt"],Je={key:0,class:"stock-warning"},Qe={class:"product-info"},We={class:"description"},Ze={class:"product-footer"},et={class:"points"},tt={class:"points-bar"},nt={__name:"ProductList",setup(e){const r=be(),a=_e(),u=Ce(),d=x(""),f=x("all"),v=x(!1),l=W(()=>{let i=[...u.products];switch(d.value&&(i=i.filter(s=>s.name.toLowerCase().includes(d.value.toLowerCase())||s.description.toLowerCase().includes(d.value.toLowerCase()))),f.value){case"low":i=i.filter(s=>s.points<=500);break;case"high":i=i.filter(s=>s.points>500);break;case"popular":i=i.slice(0,4);break}return i}),h=()=>{},_=()=>{},p=()=>{setTimeout(()=>{v.value=!1,N({type:"success",message:"重新整理完成"})},1e3)},C=i=>{r.push(`/exchange/${i}`)},b=async i=>{if(a.userInfo.points<i.points){N({type:"warning",message:"點數不足，無法兌換"});return}try{await we({title:"確認兌換",message:`確定要兌換「${i.name}」嗎？
需要 ${i.points} 點數`}),a.deductPoints(i.points)&&(a.addExchangeRecord({productName:i.name,points:i.points,type:"exchange"}),N({type:"success",message:"兌換成功！"}))}catch{}};return(i,s)=>{const T=oe,g=Me,k=ue,S=re,w=ie,n=$e,t=Ne;return L(),$("div",je,[c(T,{title:"商品兌換","left-arrow":"",onClickLeft:s[0]||(s[0]=o=>i.$router.back())}),m("div",Oe,[c(g,{modelValue:d.value,"onUpdate:modelValue":s[1]||(s[1]=o=>d.value=o),placeholder:"搜尋商品",onSearch:h},null,8,["modelValue"])]),m("div",qe,[c(S,{active:f.value,"onUpdate:active":s[2]||(s[2]=o=>f.value=o),onChange:_},{default:E(()=>[c(k,{title:"全部商品",name:"all"}),c(k,{title:"低點數",name:"low"}),c(k,{title:"高點數",name:"high"}),c(k,{title:"熱門",name:"popular"})]),_:1},8,["active"])]),m("div",Ke,[c(t,{modelValue:v.value,"onUpdate:modelValue":s[3]||(s[3]=o=>v.value=o),onRefresh:p},{default:E(()=>[c(n,null,{default:E(()=>[m("div",Ye,[(L(!0),$(ke,null,Te(l.value,o=>(L(),$("div",{key:o.id,class:"product-card",onClick:R=>C(o.id)},[m("div",Ge,[m("img",{src:o.image,alt:o.name},null,8,Xe),o.stock<10?(L(),$("div",Je," 僅剩 "+y(o.stock)+" 件 ",1)):pe("",!0)]),m("div",Qe,[m("h3",null,y(o.name),1),m("p",We,y(o.description),1),m("div",Ze,[m("span",et,y(o.points)+" 點",1),c(w,{type:"primary",size:"small",disabled:B(a).userInfo.points<o.points,onClick:xe(R=>b(o),["stop"])},{default:E(()=>[Se(y(B(a).userInfo.points<o.points?"點數不足":"立即兌換"),1)]),_:2},1032,["disabled","onClick"])])])],8,ze))),128))])]),_:1})]),_:1},8,["modelValue"])]),m("div",tt,[m("span",null,"我的點數："+y(B(a).userInfo.points),1)])])}}},ut=ve(nt,[["__scopeId","data-v-a1c3af17"]]);export{ut as default};
