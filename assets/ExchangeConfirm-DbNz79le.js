/* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              */import{a as m,f as g,o as R,W as D,Q as V,K as d,j as o,P as s,O as a,M as u,B as c,X as b,R as i,u as z}from"./vendor-D3f-zqfy.js";import{_ as M,u as j}from"./index-BhL1k30R.js";import{u as F}from"./products-mA5VcQiw.js";import{s as f,N as G,f as K,b as O,C as Q,B as U,E as W,g as X,c as q,d as A,h as H}from"./vant-mJHwfJc2.js";const J={class:"exchange-confirm"},Y={key:0,class:"loading-state"},Z={key:1,class:"content"},ee={class:"product-section"},te=["src","alt"],oe={class:"product-title"},se={class:"product-description"},ae={class:"points-section"},ne={class:"notice-section"},le={class:"exchange-button"},ue={key:2,class:"error-state"},ce={__name:"ExchangeConfirm",setup(ie){const C=D(),h=V(),l=j(),p=F(),e=m(null),v=m(!1),y=m(!0),k=g(()=>e.value?(l.userInfo.points||0)-(e.value.points||0):0),S=g(()=>e.value?e.value.stock>0&&(l.userInfo.points||0)>=(e.value.points||0):!1),T=g(()=>e.value?e.value.stock===0?"商品缺貨":(l.userInfo.points||0)<(e.value.points||0)?"點數不足":`確認兌換 (${e.value.points} 點)`:"載入中..."),E=()=>{A({title:"確認兌換",message:`確定要用 ${e.value.points} 點兌換「${e.value.name}」嗎？`,confirmButtonText:"確認兌換",cancelButtonText:"取消"}).then(()=>{I()}).catch(()=>{})},I=async()=>{v.value=!0;try{await new Promise(t=>setTimeout(t,1e3)),l.deductPoints(e.value.points)?(p.updateProductStock&&p.updateProductStock(e.value.id,e.value.stock-1),l.addExchangeRecord({productName:e.value.name,points:e.value.points,productImage:e.value.image,type:"exchange"}),H("兌換成功！"),setTimeout(()=>{h.push("/history")},1500)):f({type:"danger",message:"點數不足，兌換失敗"})}catch{f({type:"danger",message:"兌換失敗，請重試"})}finally{v.value=!1}};return R(()=>{const n=C.params.id;console.log("Product ID:",n),setTimeout(()=>{e.value=p.getProductById(n),console.log("Found product:",e.value),y.value=!1,e.value||(f({type:"danger",message:"商品不存在"}),setTimeout(()=>{h.back()},1500))},500)}),(n,t)=>{const P=G,w=K,_=X,N=O,r=q,x=Q,B=U,$=W;return u(),d("div",J,[o(P,{title:"兌換確認","left-arrow":"",onClickLeft:t[0]||(t[0]=L=>n.$router.back())}),y.value?(u(),d("div",Y,[o(w,{size:"24px",vertical:""},{default:s(()=>t[2]||(t[2]=[c("載入中...")])),_:1,__:[2]})])):e.value?(u(),d("div",Z,[a("div",ee,[o(N,null,{thumb:s(()=>[a("img",{src:e.value.image,alt:e.value.name,class:"product-thumb"},null,8,te)]),title:s(()=>[a("div",oe,i(e.value.name),1)]),desc:s(()=>[a("div",se,i(e.value.description),1)]),tags:s(()=>[o(_,{type:"warning"},{default:s(()=>[c(i(e.value.points)+" 點",1)]),_:1}),e.value.stock>0?(u(),b(_,{key:0,type:"success"},{default:s(()=>[c("庫存："+i(e.value.stock),1)]),_:1})):(u(),b(_,{key:1,type:"danger"},{default:s(()=>t[3]||(t[3]=[c("缺貨")])),_:1,__:[3]}))]),_:1})]),a("div",ae,[o(x,{title:"點數資訊"},{default:s(()=>[o(r,{title:"目前點數",value:(z(l).userInfo.points||0).toLocaleString()},null,8,["value"]),o(r,{title:"所需點數",value:(e.value.points||0).toLocaleString()},null,8,["value"]),o(r,{title:"兌換後剩餘",value:k.value.toLocaleString(),"value-class":k.value<0?"negative-points":"positive-points"},null,8,["value","value-class"])]),_:1})]),a("div",ne,[o(x,{title:"兌換須知"},{default:s(()=>[o(r,null,{default:s(()=>t[4]||(t[4]=[a("div",{class:"notice-content"},[a("p",null,"• 兌換後點數將立即扣除，無法退回"),a("p",null,"• 兌換商品將於3-5個工作天內寄送"),a("p",null,"• 如有問題請聯繫客服：0800-123-456"),a("p",null,"• 兌換紀錄可在「兌換紀錄」中查看")],-1)])),_:1,__:[4]})]),_:1})]),a("div",le,[o(B,{type:"primary",block:"",size:"large",disabled:!S.value,loading:v.value,onClick:E},{default:s(()=>[c(i(T.value),1)]),_:1},8,["disabled","loading"])])])):(u(),d("div",ue,[o($,{description:"商品不存在"}),o(B,{type:"primary",onClick:t[1]||(t[1]=L=>n.$router.push("/products"))},{default:s(()=>t[5]||(t[5]=[c(" 返回商品列表 ")])),_:1,__:[5]})]))])}}},ye=M(ce,[["__scopeId","data-v-998c0206"]]);export{ye as default};
